before_script:
  - git clean -f
  - export LANG=C
  - ulimit -s unlimited
  - ulimit -v unlimited
  - echo "HOST " $(hostname)
  - echo $CI_RUNNER_DESCRIPTION
  - echo $CI_RUNNER_TAGS
  - export SLURM=yes
  - export INTERACTIVE_RUN=yes
  - if [ "$(hostname)" = "amarek-elpa-gitlab-runner-1" ]; then module purge && module load git && module list && export INTERACTIVE_RUN=yes && export SLURM=no && source ./ci_test_scripts/.ci-env-vars; fi
  - if [ "$(hostname)" = "amarek-elpa-gitlab-runner-2" ]; then module purge && module load git && module list && export INTERACTIVE_RUN=yes && export SLURM=no && source ./ci_test_scripts/.ci-env-vars; fi
  - if [ "$(hostname)" = "amarek-elpa-gitlab-runner-3" ]; then module purge && module load git && module list && export INTERACTIVE_RUN=yes && export SLURM=no && source ./ci_test_scripts/.ci-env-vars; fi
  - if [ "$(hostname)" = "amarek-elpa-gitlab-runner-4" ]; then module purge && module load git && module list && export INTERACTIVE_RUN=yes && export SLURM=no && source ./ci_test_scripts/.ci-env-vars; fi
  - module list
  - source ./ci_test_scripts/.ci-env-vars
  - if [ "$CI_RUNNER_DESCRIPTION" = "freya01-interactive" ]; then export INTERACTIVE_RUN=yes && export SLURM=no; fi
  - if [ "$CI_RUNNER_DESCRIPTION" = "freya01-interactive-2" ]; then export INTERACTIVE_RUN=yes && export SLURM=no; fi


  - export MATRIX_SIZE=150
  - export NUMBER_OF_EIGENVECTORS=150
  - export BLOCK_SIZE=16
  - if [ "$MEDIUM_MATRIX" = "yes" ]; then export MATRIX_SIZE=1500 && export NUMBER_OF_EIGENVECTORS=750; fi
  - if [ "$LARGE_MATRIX" = "yes" ]; then export MATRIX_SIZE=5000 && export NUMBER_OF_EIGENVECTORS=500; fi
  - if [ "$GPU_BLOCKSIZE" = "yes" ]; then export BLOCK_SIZE=128 ; fi
  - if [ -z "$PIPELINE_MPI_TASKS" ]; then export MPI_TASKS=2; else export MPI_TASKS=$PIPELINE_MPI_TASKS; fi
  - echo "This test will run with matrix size na = $MATRIX_SIZE, nev= $NUMBER_OF_EIGENVECTORS, on a blacs grid with blocksize nblk= $BLOCK_SIZE " 
  - export SKIP_STEP=0
  - ./autogen.sh
  - export SKIP_STEP=0
  - if [ -f /etc/profile.d/modules.sh ]; then source /etc/profile.d/modules.sh ; else source /etc/profile.d/mpcdf_modules.sh; fi  && . ./ci_test_scripts/.ci-env-vars



