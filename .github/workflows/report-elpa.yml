name: ELPA Xe Performance Dashboard
on:
  - workflow_dispatch
jobs:
  dashboard:
    strategy:
      fail-fast: false
      matrix:
        numbers:
          - real
          - complex
        problem-size:
          - 10000
          - 15000
          - 20000
        config:
          - arch: pvc
            ranks: 1
            slurm-partition: QZ1J-ICX-PVC
            runner: pvc
          - arch: pvc
            ranks: 2
            slurm-partition: QZ1J-ICX-PVC
            runner: pvc
          - arch: pvc
            ranks: 8
            slurm-partition: QZ1B-SPR-4oam-PVC
            runner: pvc
          - arch: a100
            ranks: 2
            slurm-partition: a100-80G
            runner: nvidia
          - arch: h100
            ranks: 2
            slurm-partition: H100
            runner: nvidia
    uses: intel-sandbox/xcss-workflows/.github/workflows/xe-performance-dashboard.yml@main
    with:
      application: ELPA
      build-script: .github/scripts/build_elpa.sh ${{ matrix.config.arch }} ${{ matrix.problem-size }} ${{ matrix.numbers }} ${{ matrix.config.ranks }}
      run-script: .github/scripts/run_elpa.sh ${{ matrix.config.arch }} ${{ matrix.problem-size }} ${{ matrix.numbers }} ${{ matrix.config.ranks }}
      verify-script: .github/scripts/parseOutput.py -v cpa_results/elpa_${{ matrix.numbers }}_${{ matrix.config.arch }}_${{ matrix.config.ranks }}_${{ matrix.problem-size }}.txt
      metrics-script: .github/scripts/parseOutput.py -p -i ${{ matrix.numbers }}_${{ matrix.config.arch }}_${{ matrix.config.ranks }} -w ${{ matrix.numbers }}_${{ matrix.problem-size }} cpa_results/elpa_${{ matrix.numbers }}_${{ matrix.config.arch }}_${{ matrix.config.ranks }}_${{ matrix.problem-size }}.txt
      slurm-partition: ${{ matrix.config.slurm-partition }}
      runs-on: ${{ matrix.config.runner }}
